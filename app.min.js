// 图片懒加载
function initLazyLoad() {
    const images = document.querySelectorAll("img[data-src]");
    const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.removeAttribute("data-src");
                observer.unobserve(img);
            }
        });
    });
    images.forEach(img => imageObserver.observe(img));
}

// 显示模态框（使用jQuery）
function showModal(type) {
    $('.modal-container').fadeIn(300);
    $(`#${type}-modal`).fadeIn(300);
    $('body').addClass('modal-open');
}

// 隐藏模态框（使用jQuery）
function hideModal() {
    $('.modal-container').fadeOut(300);
    $('.modal').fadeOut(300);
    $('body').removeClass('modal-open');
}

// 关闭通知
function closeNotice() {
    const notice = document.getElementById('siteNotice');
    if (notice) {
        notice.style.display = 'none';
        document.body.style.overflow = '';
    }
}

// 初始化通知弹窗
function initNotice() {
    const notice = document.getElementById('siteNotice');
    if (notice) {
        notice.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeNotice();
            }
        });
        
        notice.addEventListener('click', function(e) {
            if (e.target === notice) {
                closeNotice();
            }
        });
    }
}

// 初始化模态框事件
function initModals() {
    $('.nav-link, .news-link').click(function(e) {
        e.preventDefault();
        const modalType = $(this).data('modal');
        if (modalType) {
            showModal(modalType);
        }
    });
    
    $('.close-btn').click(function() {
        hideModal();
    });
    
    $('.modal-container').click(function(e) {
        if ($(e.target).hasClass('modal-container')) {
            hideModal();
        }
    });
    
    $(document).keydown(function(e) {
        if (e.keyCode === 27) {
            hideModal();
        }
    });
}

// 初始化标签页
function initTabs() {
    $('.tab').click(function() {
        $('.tab').removeClass('active');
        $(this).addClass('active');
        
        const tabType = $(this).index();
        if (tabType === 0) {
            $('.news-list').show();
        }
        // 其他标签页功能可在此处扩展
    });
}

// 页面加载完成后初始化所有功能
$(document).ready(function() {
    // jQuery依赖的功能
    initModals();
    initTabs();
    
    // 原生JS功能
    initLazyLoad();
    initNotice();
}); 